# ValidKun Chrome拡張機能

OpenAPI仕様書に基づいてネットワークトラフィックを自動検証するDevTools拡張機能です。

## 🚀 インストール方法

### 1. ビルド

```bash
npm install
npm run build
```

### 2. Chromeに読み込む

1. Chromeで `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をONにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このプロジェクトのルートディレクトリを選択

### 3. アイコンの準備（オプション）

`icons/` ディレクトリに以下のアイコンを配置してください：
- `icon16.png` (16x16px)
- `icon48.png` (48x48px)
- `icon128.png` (128x128px)

または、ImageMagickがインストールされている場合：

```bash
chmod +x create-icons.sh
./create-icons.sh
```

## 📖 使い方

### 1. DevToolsを開く

1. 任意のWebページを開く
2. F12キーまたは右クリック→「検証」でDevToolsを開く
3. DevToolsのタブに「ValidKun」が追加されています

### 2. OpenAPI仕様書を読み込む

1. ValidKunパネルを開く
2. 右上の📄アイコンをクリック
3. OpenAPI仕様書（YAML/JSON）を選択
4. 仕様書はChrome Storageに保存され、別のページでも利用可能です

### 3. 自動バリデーション

- ページでネットワークリクエストが発生すると自動的にキャプチャされます
- OpenAPI仕様書とマッチするリクエストは自動でバリデーションされます
- 結果は左側のリストに色分けして表示されます

### 4. 色分けルール

リクエスト一覧の左側のインジケーターで状態を判別できます：

- 🟢 **緑**: 成功（2xx）でスキーマも正常
- 🔴 **赤**: スキーマ違反が検出された
- 🟡 **黄色**: 失敗（4xx, 5xx）またはスキーマ違反なし

### 5. 詳細表示

左側のリストからリクエストを選択すると、右側に詳細が表示されます：

- **Request Information**: メソッド、URL、ステータス、タイムスタンプ
- **Matched Path**: マッチしたOpenAPIパス
- **Validation Result**: 
  - リクエストボディのバリデーション結果
  - レスポンスボディのバリデーション結果
  - エラー詳細（スキーマ違反がある場合）
- **Request/Response Body**: 実際のリクエスト・レスポンス内容

## 🎯 主な機能

### 自動ネットワーク監視

- DevToolsが開いている間、すべてのネットワークリクエストを監視
- リクエスト・レスポンスの内容を自動キャプチャ
- 履歴として保存（クリアボタンで削除可能）

### インテリジェントなパスマッチング

- フルURL（`https://api.example.com/users/123?key=value`）に対応
- パスパラメータ（`/users/{userId}`）を自動抽出
- クエリパラメータを自動除去

### リアルタイムバリデーション

- リクエストボディのスキーマ検証
- レスポンスボディのスキーマ検証
- ステータスコード別の検証
- 詳細なエラーメッセージ

### 永続的なストレージ

- Chrome Storageを使用
- 一度読み込んだ仕様書は別のページでも利用可能
- ブラウザを再起動しても保持

## 🔧 開発

### プロジェクト構成

```
validkun/
├── manifest.json          # Chrome拡張機能マニフェスト
├── devtools.html          # DevToolsエントリーポイント
├── panel.html             # パネルHTML（2パネル構造）
├── styles-panel.css       # パネル用CSS
├── src/
│   ├── devtools.ts        # DevTools起動スクリプト
│   ├── panel.ts           # パネルメインロジック
│   ├── chromeStorage.ts   # Chrome Storage API
│   ├── fileLoader.ts      # YAML/JSONローダー
│   ├── pathMatcher.ts     # URLパスマッチング
│   ├── validator.ts       # バリデーションロジック
│   └── types.ts           # 型定義
└── dist/
    ├── devtools.js        # ビルド済みDevToolsスクリプト
    ├── panel.js           # ビルド済みパネルスクリプト
    └── bundle.js          # スタンドアロン版（後方互換）
```

### コマンド

```bash
# ビルド
npm run build

# クリーンビルド
npm run rebuild

# 開発モード（ウォッチ）
npm run dev

# 型チェック
npm run type-check

# リント
npm run lint
```

### 開発時の注意点

1. コードを変更したら `npm run build` を実行
2. Chromeの拡張機能ページで「更新」ボタンをクリック
3. DevToolsを閉じて再度開く

## 🆚 スタンドアロン版との違い

このプロジェクトは2つの使用方法に対応しています：

### Chrome拡張機能版（推奨）

- DevToolsとして動作
- 自動ネットワーク監視
- リアルタイムバリデーション
- Chrome Storage使用

### スタンドアロン版

- `index.html` をブラウザで開く
- 手動でURL・ボディを入力
- LocalStorage使用
- `npm run preview` でサーバー起動可能

## 📝 使用例

### APIテスト中の利用

1. 開発中のAPIをブラウザでテスト
2. ValidKunが自動でリクエストをキャプチャ
3. スキーマ違反を即座に検出
4. 詳細なエラー情報で問題箇所を特定

### フロントエンド開発中の利用

1. React/Vue等のSPAを開発
2. APIとの通信を自動監視
3. バックエンドとの仕様整合性を確認
4. 不正なリクエスト・レスポンスを早期発見

## 🐛 トラブルシューティング

### 拡張機能が表示されない

- ビルドが完了しているか確認
- `dist/` ディレクトリにファイルが生成されているか確認
- Chromeの拡張機能ページで「エラー」を確認

### 仕様書が読み込めない

- YAML/JSON形式が正しいか確認
- OpenAPI 2.0/3.x形式に準拠しているか確認
- コンソールにエラーが出ていないか確認

### リクエストが表示されない

- DevToolsを開いた**後**のリクエストが対象
- ページをリロードしてリクエストを再生成
- ネットワークタブでリクエストが発生しているか確認

### バリデーションが実行されない

- 仕様書が正しく読み込まれているか確認
- URLパターンが仕様書と一致しているか確認
- HTTPメソッドが一致しているか確認

## 📄 ライセンス

MIT

