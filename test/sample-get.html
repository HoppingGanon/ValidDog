<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† - Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-primary: #0f0f14;
        --bg-secondary: #16161e;
        --bg-tertiary: #1e1e2a;
        --bg-card: #1a1a24;
        --bg-card-hover: #22222e;
        --border-color: #2a2a3a;
        --border-active: #4a4a6a;
        --text-primary: #e8e8f0;
        --text-secondary: #a0a0b8;
        --text-muted: #6a6a80;
        --accent-primary: #6366f1;
        --accent-secondary: #818cf8;
        --accent-glow: rgba(99, 102, 241, 0.2);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 16px;
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
        --shadow-glow: 0 0 30px var(--accent-glow);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Noto Sans JP', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        line-height: 1.6;
      }

      /* èƒŒæ™¯ãƒ‘ã‚¿ãƒ¼ãƒ³ */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background:
          radial-gradient(ellipse at 20% 0%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
          radial-gradient(ellipse at 80% 100%, rgba(129, 140, 248, 0.06) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 24px;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
      header {
        margin-bottom: 40px;
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: var(--shadow-glow);
      }

      .logo-text {
        font-size: 24px;
        font-weight: 600;
        letter-spacing: -0.5px;
      }

      .logo-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
      .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 32px;
      }

      .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 20px 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        border-color: var(--border-active);
        transform: translateY(-2px);
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .stat-icon.users {
        background: rgba(99, 102, 241, 0.15);
      }
      .stat-icon.active {
        background: rgba(16, 185, 129, 0.15);
      }
      .stat-icon.inactive {
        background: rgba(245, 158, 11, 0.15);
      }
      .stat-icon.suspended {
        background: rgba(239, 68, 68, 0.15);
      }

      .stat-info h3 {
        font-size: 28px;
        font-weight: 600;
        line-height: 1;
      }

      .stat-info p {
        font-size: 13px;
        color: var(--text-muted);
        margin-top: 4px;
      }

      /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
      .filters-section {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-bottom: 24px;
      }

      .filters-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .filters-header h2 {
        font-size: 16px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .filter-group label {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .filter-group select,
      .filter-group input {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        padding: 10px 14px;
        color: var(--text-primary);
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s ease;
      }

      .filter-group select:focus,
      .filter-group input:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px var(--accent-glow);
      }

      .filter-group select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236a6a80' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 40px;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 20px;
        border-radius: var(--radius-sm);
        font-size: 14px;
        font-weight: 500;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        box-shadow: 0 2px 10px var(--accent-glow);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 20px var(--accent-glow);
      }

      .btn-secondary {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
      }

      .btn-secondary:hover {
        background: var(--bg-card-hover);
        border-color: var(--border-active);
      }

      /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚°ãƒªãƒƒãƒ‰ */
      .users-section {
        margin-bottom: 32px;
      }

      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .section-header h2 {
        font-size: 18px;
        font-weight: 600;
      }

      .users-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
      }

      .user-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .user-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .user-card:hover {
        border-color: var(--border-active);
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
      }

      .user-card:hover::before {
        opacity: 1;
      }

      .user-header {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 16px;
      }

      .user-avatar {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        font-weight: 600;
        color: white;
        flex-shrink: 0;
      }

      .user-info {
        flex: 1;
        min-width: 0;
      }

      .user-name {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .user-email {
        font-size: 13px;
        color: var(--text-secondary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .user-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .user-status.active {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }

      .user-status.inactive {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }

      .user-status.suspended {
        background: rgba(239, 68, 68, 0.15);
        color: var(--danger);
      }

      .user-status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: currentColor;
      }

      .user-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .user-detail {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .user-detail-label {
        font-size: 11px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .user-detail-value {
        font-size: 13px;
        color: var(--text-secondary);
      }

      .user-id {
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border-color);
      }

      /* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */
      .pagination {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 24px 0;
      }

      .pagination-btn {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .pagination-btn:hover:not(:disabled) {
        background: var(--bg-card-hover);
        border-color: var(--border-active);
      }

      .pagination-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .pagination-btn.active {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
        color: white;
      }

      .pagination-info {
        font-size: 13px;
        color: var(--text-muted);
        padding: 0 16px;
      }

      /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        padding: 24px;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        transform: scale(0.95) translateY(20px);
        transition: transform 0.3s ease;
      }

      .modal-overlay.active .modal {
        transform: scale(1) translateY(0);
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px;
        border-bottom: 1px solid var(--border-color);
      }

      .modal-header h2 {
        font-size: 20px;
        font-weight: 600;
      }

      .modal-close {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-sm);
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: var(--bg-tertiary);
        border-color: var(--border-active);
      }

      .modal-body {
        padding: 24px;
      }

      .detail-profile {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        padding-bottom: 24px;
        border-bottom: 1px solid var(--border-color);
      }

      .detail-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        font-weight: 600;
        color: white;
        flex-shrink: 0;
      }

      .detail-info h3 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .detail-info p {
        color: var(--text-secondary);
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
      }

      .detail-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .detail-item.full-width {
        grid-column: span 2;
      }

      .detail-label {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .detail-value {
        font-size: 15px;
        color: var(--text-primary);
      }

      .detail-value.mono {
        font-family: 'JetBrains Mono', monospace;
        font-size: 13px;
        color: var(--text-secondary);
      }

      /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px;
        gap: 16px;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--border-color);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: var(--text-muted);
        font-size: 14px;
      }

      /* ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ */
      .error-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 60px;
        gap: 16px;
        text-align: center;
      }

      .error-icon {
        font-size: 48px;
        opacity: 0.5;
      }

      .error-message {
        color: var(--danger);
        font-size: 14px;
      }

      /* ç©ºçŠ¶æ…‹ */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 80px;
        gap: 16px;
        text-align: center;
      }

      .empty-icon {
        font-size: 64px;
        opacity: 0.3;
      }

      .empty-title {
        font-size: 18px;
        font-weight: 500;
      }

      .empty-desc {
        color: var(--text-muted);
        font-size: 14px;
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
      @media (max-width: 768px) {
        .container {
          padding: 24px 16px;
        }

        .header-content {
          flex-direction: column;
          align-items: flex-start;
        }

        .filters-grid {
          grid-template-columns: 1fr;
        }

        .users-grid {
          grid-template-columns: 1fr;
        }

        .detail-profile {
          flex-direction: column;
          text-align: center;
        }

        .detail-grid {
          grid-template-columns: 1fr;
        }

        .detail-item.full-width {
          grid-column: span 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header>
        <div class="header-content">
          <div class="logo">
            <div class="logo-icon">ğŸ‘¥</div>
            <div>
              <div class="logo-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</div>
              <div class="logo-subtitle">User Management</div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="fetchUsers()">ğŸ”„ æ›´æ–°</button>
        </div>
      </header>

      <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon users">ğŸ‘¥</div>
          <div class="stat-info">
            <h3 id="stat-total">-</h3>
            <p>ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon active">âœ“</div>
          <div class="stat-info">
            <h3 id="stat-active">-</h3>
            <p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon inactive">â¸</div>
          <div class="stat-info">
            <h3 id="stat-inactive">-</h3>
            <p>éã‚¢ã‚¯ãƒ†ã‚£ãƒ–</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon suspended">âš </div>
          <div class="stat-info">
            <h3 id="stat-suspended">-</h3>
            <p>åœæ­¢ä¸­</p>
          </div>
        </div>
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="filters-section">
        <div class="filters-header">
          <h2>ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ & ã‚½ãƒ¼ãƒˆ</h2>
          <button class="btn btn-secondary" onclick="resetFilters()">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div class="filters-grid">
          <div class="filter-group">
            <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
            <select id="filter-status" onchange="fetchUsers()">
              <option value="">ã™ã¹ã¦</option>
              <option value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
              <option value="inactive">éã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
              <option value="suspended">åœæ­¢ä¸­</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ã‚½ãƒ¼ãƒˆé †</label>
            <select id="filter-sort" onchange="fetchUsers()">
              <option value="">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
              <option value="createdAt">ä½œæˆæ—¥æ™‚</option>
              <option value="updatedAt">æ›´æ–°æ—¥æ™‚</option>
              <option value="name">åå‰</option>
            </select>
          </div>
          <div class="filter-group">
            <label>è¡¨ç¤ºä»¶æ•°</label>
            <select id="filter-limit" onchange="fetchUsers()">
              <option value="10">10ä»¶</option>
              <option value="20" selected>20ä»¶</option>
              <option value="50">50ä»¶</option>
              <option value="100">100ä»¶</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ãƒšãƒ¼ã‚¸</label>
            <input type="number" id="filter-page" value="1" min="1" onchange="fetchUsers()" />
          </div>
        </div>
      </div>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="users-section">
        <div class="section-header">
          <h2>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
          <span id="users-count" style="color: var(--text-muted); font-size: 14px"></span>
        </div>
        <div id="users-container">
          <div class="loading">
            <div class="spinner"></div>
            <div class="loading-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        </div>
      </div>

      <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div id="pagination-container" class="pagination" style="display: none"></div>
    </div>

    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="user-modal" class="modal-overlay" onclick="closeModal(event)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°</h2>
          <button class="modal-close" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯JavaScriptã§æŒ¿å…¥ -->
        </div>
      </div>
    </div>

    <script>
      const BASE_URL = 'http://localhost:3001';
      let currentPagination = null;

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’å–å¾—
      async function fetchUsers() {
        const container = document.getElementById('users-container');
        const paginationContainer = document.getElementById('pagination-container');

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        container.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
      `;
        paginationContainer.style.display = 'none';

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
        const status = document.getElementById('filter-status').value;
        const sort = document.getElementById('filter-sort').value;
        const limit = document.getElementById('filter-limit').value;
        const page = document.getElementById('filter-page').value;

        // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
        const params = new URLSearchParams();
        if (status) params.append('status', status);
        if (sort) params.append('sort', sort);
        if (limit) params.append('limit', limit);
        if (page) params.append('page', page);

        const url = `${BASE_URL}/users${params.toString() ? '?' + params.toString() : ''}`;

        try {
          const response = await fetch(url);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          if (!data.users || data.users.length === 0) {
            container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">ğŸ”</div>
              <div class="empty-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
              <div class="empty-desc">æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„</div>
            </div>
          `;
            return;
          }

          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
          renderUsers(data.users);

          // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
          if (data.pagination) {
            currentPagination = data.pagination;
            renderPagination(data.pagination);
          }

          // çµ±è¨ˆã‚’æ›´æ–°
          updateStats(data.users);
        } catch (error) {
          console.error('Error fetching users:', error);
          container.innerHTML = `
          <div class="error-state">
            <div class="error-icon">âš ï¸</div>
            <div class="error-message">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>
            <div class="error-message" style="font-size: 12px; color: var(--text-muted);">${error.message}</div>
            <button class="btn btn-primary" onclick="fetchUsers()" style="margin-top: 16px;">å†è©¦è¡Œ</button>
          </div>
        `;
        }
      }

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’æç”»
      function renderUsers(users) {
        const container = document.getElementById('users-container');
        document.getElementById('users-count').textContent = `${users.length}ä»¶è¡¨ç¤º`;

        container.innerHTML = `
        <div class="users-grid">
          ${users
            .map(
              (user) => `
            <div class="user-card" onclick="openUserDetail('${user.id}')">
              <div class="user-header">
                <div class="user-avatar">${getInitials(user.name)}</div>
                <div class="user-info">
                  <div class="user-name">${escapeHtml(user.name)}</div>
                  <div class="user-email">${escapeHtml(user.email)}</div>
                </div>
                <span class="user-status ${user.status || 'active'}">
                  <span class="user-status-dot"></span>
                  ${getStatusLabel(user.status)}
                </span>
              </div>
              <div class="user-details">
                <div class="user-detail">
                  <span class="user-detail-label">å¹´é½¢</span>
                  <span class="user-detail-value">${
                    user.age !== undefined ? user.age + 'æ­³' : '-'
                  }</span>
                </div>
                <div class="user-detail">
                  <span class="user-detail-label">é›»è©±ç•ªå·</span>
                  <span class="user-detail-value">${user.phoneNumber || '-'}</span>
                </div>
                <div class="user-detail">
                  <span class="user-detail-label">ä½œæˆæ—¥</span>
                  <span class="user-detail-value">${formatDate(user.createdAt)}</span>
                </div>
                <div class="user-detail">
                  <span class="user-detail-label">æ›´æ–°æ—¥</span>
                  <span class="user-detail-value">${formatDate(user.updatedAt)}</span>
                </div>
              </div>
              <div class="user-id">ID: ${user.id}</div>
            </div>
          `,
            )
            .join('')}
        </div>
      `;
      }

      // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’æç”»
      function renderPagination(pagination) {
        const container = document.getElementById('pagination-container');
        const { page, totalPages, total } = pagination;

        if (totalPages <= 1) {
          container.style.display = 'none';
          return;
        }

        container.style.display = 'flex';

        let buttons = '';

        // å‰ã¸ãƒœã‚¿ãƒ³
        buttons += `<button class="pagination-btn" onclick="goToPage(${
          page - 1
        })" ${page <= 1 ? 'disabled' : ''}>â†</button>`;

        // ãƒšãƒ¼ã‚¸ç•ªå·ãƒœã‚¿ãƒ³
        const maxVisible = 5;
        let startPage = Math.max(1, page - Math.floor(maxVisible / 2));
        let endPage = Math.min(totalPages, startPage + maxVisible - 1);

        if (endPage - startPage < maxVisible - 1) {
          startPage = Math.max(1, endPage - maxVisible + 1);
        }

        if (startPage > 1) {
          buttons += `<button class="pagination-btn" onclick="goToPage(1)">1</button>`;
          if (startPage > 2) {
            buttons += `<span class="pagination-info">...</span>`;
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          buttons += `<button class="pagination-btn ${
            i === page ? 'active' : ''
          }" onclick="goToPage(${i})">${i}</button>`;
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            buttons += `<span class="pagination-info">...</span>`;
          }
          buttons += `<button class="pagination-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
        }

        // æ¬¡ã¸ãƒœã‚¿ãƒ³
        buttons += `<button class="pagination-btn" onclick="goToPage(${
          page + 1
        })" ${page >= totalPages ? 'disabled' : ''}>â†’</button>`;

        container.innerHTML = buttons + `<span class="pagination-info">${total}ä»¶ä¸­</span>`;
      }

      // ãƒšãƒ¼ã‚¸é·ç§»
      function goToPage(page) {
        document.getElementById('filter-page').value = page;
        fetchUsers();
      }

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚’å–å¾—ã—ã¦è¡¨ç¤º
      async function openUserDetail(userId) {
        const modal = document.getElementById('user-modal');
        const modalBody = document.getElementById('modal-body');

        modal.classList.add('active');
        modalBody.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">è©³ç´°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
      `;

        try {
          const response = await fetch(`${BASE_URL}/users/${userId}?includeDetails=true`);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const user = await response.json();
          renderUserDetail(user);
        } catch (error) {
          console.error('Error fetching user detail:', error);
          modalBody.innerHTML = `
          <div class="error-state">
            <div class="error-icon">âš ï¸</div>
            <div class="error-message">è©³ç´°æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>
            <div class="error-message" style="font-size: 12px; color: var(--text-muted);">${error.message}</div>
          </div>
        `;
        }
      }

      // ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚’æç”»
      function renderUserDetail(user) {
        const modalBody = document.getElementById('modal-body');

        const address = user.address
          ? `ã€’${user.address.postalCode || '-'} ${
              user.address.prefecture || ''
            }${user.address.city || ''}${user.address.street || ''}`
          : '-';

        modalBody.innerHTML = `
        <div class="detail-profile">
          <div class="detail-avatar">${getInitials(user.name)}</div>
          <div class="detail-info">
            <h3>${escapeHtml(user.name)}</h3>
            <p>${escapeHtml(user.email)}</p>
            <span class="user-status ${user.status || 'active'}" style="margin-top: 8px;">
              <span class="user-status-dot"></span>
              ${getStatusLabel(user.status)}
            </span>
          </div>
        </div>
        <div class="detail-grid">
          <div class="detail-item full-width">
            <span class="detail-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</span>
            <span class="detail-value mono">${user.id}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å¹´é½¢</span>
            <span class="detail-value">${user.age !== undefined ? user.age + 'æ­³' : '-'}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">é›»è©±ç•ªå·</span>
            <span class="detail-value">${user.phoneNumber || '-'}</span>
          </div>
          <div class="detail-item full-width">
            <span class="detail-label">ä½æ‰€</span>
            <span class="detail-value">${escapeHtml(address)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ä½œæˆæ—¥æ™‚</span>
            <span class="detail-value">${formatDateTime(user.createdAt)}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ›´æ–°æ—¥æ™‚</span>
            <span class="detail-value">${formatDateTime(user.updatedAt)}</span>
          </div>
        </div>
      `;
      }

      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      function closeModal(event) {
        if (event && event.target !== event.currentTarget) return;
        document.getElementById('user-modal').classList.remove('active');
      }

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
      function resetFilters() {
        document.getElementById('filter-status').value = '';
        document.getElementById('filter-sort').value = '';
        document.getElementById('filter-limit').value = '20';
        document.getElementById('filter-page').value = '1';
        fetchUsers();
      }

      // çµ±è¨ˆã‚’æ›´æ–°
      function updateStats(users) {
        const total = users.length;
        const active = users.filter((u) => u.status === 'active' || !u.status).length;
        const inactive = users.filter((u) => u.status === 'inactive').length;
        const suspended = users.filter((u) => u.status === 'suspended').length;

        document.getElementById('stat-total').textContent = currentPagination?.total || total;
        document.getElementById('stat-active').textContent = active;
        document.getElementById('stat-inactive').textContent = inactive;
        document.getElementById('stat-suspended').textContent = suspended;
      }

      // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
      function getInitials(name) {
        if (!name) return '?';
        const parts = name.split(/[\sã€€]+/);
        if (parts.length >= 2) {
          return (parts[0][0] + parts[1][0]).toUpperCase();
        }
        return name.substring(0, 2).toUpperCase();
      }

      function getStatusLabel(status) {
        const labels = {
          active: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–',
          inactive: 'éã‚¢ã‚¯ãƒ†ã‚£ãƒ–',
          suspended: 'åœæ­¢ä¸­',
        };
        return labels[status] || 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–';
      }

      function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        return date.toLocaleDateString('ja-JP', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
        });
      }

      function formatDateTime(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        return date.toLocaleString('ja-JP', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });
      }

      function escapeHtml(str) {
        if (!str) return '';
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeModal();
        }
      });

      // åˆæœŸèª­ã¿è¾¼ã¿
      document.addEventListener('DOMContentLoaded', fetchUsers);
    </script>
  </body>
</html>
